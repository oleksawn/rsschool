(()=>{"use strict";var e={11:(e,t,o)=>{e.exports=o.p+"assets/car.svg"}},t={};function o(s){var a=t[s];if(void 0!==a)return a.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,o),r.exports}o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{o(11);class e{constructor(e,t,o="div",s=""){const a=document.createElement(o);a.classList=t,a.innerHTML=s,this.el=a,this.parent=e}}class t{constructor(t){this.pageCar=new e(t,["page__car"]),this.carControls=new e(this.pageCar.el,["car__controls"]),this.controlsCarName=new e(this.carControls.el,["controls__car-name"],"p"),this.controlsLine=new e(this.carControls.el,["car__controls_line"]),this.controlsCarDelete=new e(this.controlsLine.el,["controls__car-delete"],"button","delete"),this.controlsCarGo=new e(this.controlsLine.el,["controls__car-go"],"button","Go"),this.controlsCarStop=new e(this.controlsLine.el,["controls__car-stop"],"button","Stop"),this.controlsUpdateForm=new e(this.carControls.el,["controls__car-update-form"]),this.updateFormName=new e(this.controlsUpdateForm.el,["car-update-form__name"],"input"),this.updateFormName.el.setAttribute("type","text"),this.updateFormColor=new e(this.controlsUpdateForm.el,["car-update-form__color"],"input"),this.updateFormColor.el.setAttribute("type","color"),this.updateFormOk=new e(this.controlsUpdateForm.el,["car-update-form__btn"],"button","update"),this.carTrack=new e(this.pageCar.el,["car__track"]),this.trackCarImg=new e(this.carTrack.el,["track__car-img"],"object"),this.trackCarImg.el.setAttribute("type","image/svg+xml"),this.trackCarImg.el.setAttribute("data","assets/car.svg")}}const s="http://127.0.0.1:3000";class a{constructor(){console.log("page: constructor()"),this.pageNum=1,this.carsAmount=0,this.carsArr=[],this.nodes={},this.nodes.container=new e(document.body,["container"]),this.nodes.header=new e(this.nodes.container.el,["header"]),this.nodes.garage=new e(this.nodes.container.el,["garage"]),this.nodes.garageCarsAmount=new e(this.nodes.garage.el,["garage__cars-amount"],"h2",`Garage: ${this.carsAmount} cars`),this.nodes.garagePageControls=new e(this.nodes.garage.el,["garage__page-controls"]),this.nodes.pageControlsPrevBtn=new e(this.nodes.garagePageControls.el,["page-controls__btn page-controls__btn_prev"],"button","prev"),this.nodes.pageControlsPrevBtn.el.onclick=()=>{let e=this.pageNum;e>1&&(e-=1,console.log("click prev btn - if page > 1 - go to page ",e),this.fetchData(e,!0))},this.nodes.pageControlsPageNum=new e(this.nodes.garagePageControls.el,["page-controls__page-number"],"h3",`Page #${this.pageNum}`),this.nodes.pageControlsNextBtn=new e(this.nodes.garagePageControls.el,["page-controls__btn page-controls__btn_next"],"button","next"),this.nodes.pageControlsNextBtn.el.onclick=()=>{let e=this.pageNum;this.carsAmount-7*e>0&&(e+=1,console.log("click prev btn - if page < end page - go to page ",e),this.fetchData(e,!0))},this.nodes.garageCarsControls=new e(this.nodes.garage.el,["garage__cars-controls-container"]),this.nodes.carsControlsAddOneForm=new e(this.nodes.garageCarsControls.el,["cars-controls__form"]),this.nodes.addOneFormName=new e(this.nodes.carsControlsAddOneForm.el,["cars-controls-form__name"],"input"),this.nodes.addOneFormName.el.setAttribute("type","text"),this.nodes.addOneFormColor=new e(this.nodes.carsControlsAddOneForm.el,["cars-controls-form__color"],"input"),this.nodes.addOneFormColor.el.setAttribute("type","color"),this.nodes.addOneFormOk=new e(this.nodes.carsControlsAddOneForm.el,["cars-controls-form__btn"],"button","add car"),this.nodes.addOneFormOk.el.onclick=e=>{console.log("click add one btn"),fetch(`${s}/garage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.nodes.addOneFormName.el.value,color:this.nodes.addOneFormColor.el.value})}).then((e=>{console.log("add",e),this.fetchData(this.pageNum,!0)}))},this.nodes.carsControlsAddHundred=new e(this.nodes.garageCarsControls.el,["cars-controls__btn"],"button","add hundred cars");const o=["Tesla","BMW","Audi","Bentley","Chevrolet","Citroen","Fiat","Ferrari","Ford","Honda"],a=["1","2","3","4","5","6","7","8","9","10"],r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];this.nodes.carsControlsAddHundred.el.onclick=()=>{console.log("click add-100-cars button");for(let e=0;e<100;e++){const e=`${o[Math.floor(Math.random()*o.length)]} ${a[Math.floor(Math.random()*a.length)]}`,t=`#${r[Math.floor(Math.random()*r.length)]}${r[Math.floor(Math.random()*r.length)]}${r[Math.floor(Math.random()*r.length)]}${r[Math.floor(Math.random()*r.length)]}${r[Math.floor(Math.random()*r.length)]}${r[Math.floor(Math.random()*r.length)]}`;fetch(`${s}/garage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,color:t})}).then((e=>{this.fetchData(this.pageNum,!0)}))}},this.nodes.carsControlsRaceForm=new e(this.nodes.garageCarsControls.el,["cars-controls__race-form"]),this.nodes.raceFormRace=new e(this.nodes.carsControlsRaceForm.el,["race-form__btn"],"button","race"),this.nodes.raceFormRace.el.onclick=()=>{this.nodes.raceFormRace.el.setAttribute("disabled","disabled"),this.nodes.raceFormReset.el.removeAttribute("disabled"),this.stopAllCars([],(()=>{console.log("click RACE btn");const e=[];this.nodes.cars.forEach((t=>{var o;o=t,console.log(o.trackCarImg.id),o.controlsCarGo.el.setAttribute("disabled","disabled"),o.controlsCarStop.el.removeAttribute("disabled"),o.isStopped=!1,o.isDrive=!0,fetch(`${s}/engine?id=${o.trackCarImg.el.dataset.carId}&status=started`,{method:"GET"}).then((e=>(console.log(o.trackCarImg.id,e),e.json()))).then((t=>{console.log(o.trackCarImg.id,t.distance,t.velocity);let a=0;requestAnimationFrame((function e(s){if(0===a)a=s,o.isDrive&&requestAnimationFrame(e);else{const r=(s-a)*(1120/(t.distance/t.velocity));o.trackCarImg.el.style.transform=`translateX(${r}px)`,o.isStopped&&(o.trackCarImg.el.style.transform="translateX(0px)"),r<1121&&o.isDrive&&requestAnimationFrame(e)}})),console.time(o.trackCarImg.id);const r=fetch(`${s}/engine?id=${o.trackCarImg.el.dataset.carId}&status=drive`).then((e=>(console.timeEnd(o.trackCarImg.id),console.log(o.trackCarImg.id,e,o.trackCarImg.el.style.transform),o.isDrive=!1,o.trackCarImg.id)));e.push(r),console.log(e),Promise.race(e).then((e=>(console.log("this is winner",e),e))).catch((e=>(console.log("this is woo winner",e),e)))}))}))}))},this.nodes.raceFormReset=new e(this.nodes.carsControlsRaceForm.el,["race-form__btn"],"button","reset"),this.nodes.raceFormReset.el.onclick=()=>{this.nodes.raceFormReset.el.setAttribute("disabled","disabled"),this.stopAllCars([],(()=>{this.nodes.raceFormRace.el.removeAttribute("disabled")}))},this.nodes.garagePage=new e(this.nodes.garage.el,["garage__page"]),this.nodes.cars=[];for(let e=0;e<7;e++)this.nodes.cars.push(new t(this.nodes.garagePage.el)),this.nodes.cars[e].controlsCarDelete.el.onclick=e=>{console.log("click delete btn for car #",e.target.dataset.carId),fetch(`${s}/garage/${e.target.dataset.carId}`,{method:"DELETE"}).then((e=>{console.log("delete",e),this.fetchData(this.pageNum,!0)}))},this.nodes.cars[e].updateFormOk.el.onclick=t=>{console.log("click update btn for car #",t.target.dataset.carId),fetch(`${s}/garage/${t.target.dataset.carId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.nodes.cars[e].updateFormName.el.value,color:this.nodes.cars[e].updateFormColor.el.value})}).then((e=>{console.log("update",e),this.fetchData(this.pageNum,!0)}))},function(e){e.isDrive=!1,e.isStopped=!0,e.controlsCarGo.el.onclick=t=>{console.log("click GO btn for car #",t.target.dataset.carId),e.controlsCarGo.el.setAttribute("disabled","disabled"),e.controlsCarStop.el.removeAttribute("disabled"),e.isStopped=!1,e.isDrive=!0,fetch(`${s}/engine?id=${t.target.dataset.carId}&status=started`,{method:"GET"}).then((e=>(console.log("GO",e),e.json()))).then((o=>{console.log(o.velocity,o.distance);let a=0;requestAnimationFrame((function t(s){if(0===a)a=s,e.isDrive&&requestAnimationFrame(t);else{const r=(s-a)*(1120/(o.distance/o.velocity));e.trackCarImg.el.style.transform=`translateX(${r}px)`,e.isStopped&&(e.trackCarImg.el.style.transform="translateX(0px)"),e.isDrive&&requestAnimationFrame(t)}})),fetch(`${s}/engine?id=${t.target.dataset.carId}&status=drive`).then((t=>{console.log(t),e.isDrive=!1,console.log(e.isDrive)}))}))},e.controlsCarStop.el.onclick=t=>{console.log("click STOP btn for car #",t.target.dataset.carId),e.controlsCarStop.el.setAttribute("disabled","disabled"),fetch(`${s}/engine?id=${t.target.dataset.carId}&status=stopped`,{method:"GET"}).then((t=>{console.log("STOP",t),e.isDrive=!1,e.isStopped=!0,e.trackCarImg.el.style.transform="translateX(0px)",e.controlsCarGo.el.removeAttribute("disabled")}))}}(this.nodes.cars[e])}stopAllCars(e,t){console.log(this.nodes.cars.length);let o=!0;for(let e=0;e<this.nodes.cars.length;e++)!1===this.nodes.cars[e].isDrive&&!0===this.nodes.cars[e].isStopped?console.log("stop all cars -- if not drive & stopped"):o=!1;const a=[];if(!1===o){console.log("Animated");for(let e=0;e<this.nodes.cars.length;e++){this.nodes.cars[e].controlsCarStop.el.setAttribute("disabled","disabled"),this.nodes.cars[e].controlsCarGo.el.removeAttribute("disabled");const t=fetch(`${s}/engine?id=${this.nodes.cars[e].trackCarImg.el.dataset.carId}&status=stopped`,{method:"GET"}).then((t=>{console.log("STOP",t),this.nodes.cars[e].isDrive=!1,this.nodes.cars[e].isStopped=!0,this.nodes.cars[e].trackCarImg.el.style.transform="translateX(0px)"}));a.push(t)}this.nodes.raceFormRace.el.removeAttribute("disabled")}Promise.all(a).then((()=>{t()}))}renderPage(){console.log("page: renderPage()"),Object.values(this.nodes).forEach((e=>{void 0===e.parent?e.forEach(((e,t)=>{t<this.carsArr.length&&Object.values(e).forEach((e=>{"boolean"!=typeof e&&e.parent.appendChild(e.el)}))})):e.parent.appendChild(e.el)}))}updateData(e){console.log("page: updateData()"),this.carsArr=e,this.nodes.garageCarsAmount.el.innerText=`Garage: ${this.carsAmount} cars`,this.nodes.pageControlsPageNum.el.innerText=`Page #${this.pageNum}`,this.nodes.raceFormReset.el.setAttribute("disabled","disabled"),1===this.pageNum?this.nodes.pageControlsPrevBtn.el.setAttribute("disabled","disabled"):this.nodes.pageControlsPrevBtn.el.removeAttribute("disabled"),this.carsAmount-7*this.pageNum<=0?this.nodes.pageControlsNextBtn.el.setAttribute("disabled","disabled"):this.nodes.pageControlsNextBtn.el.removeAttribute("disabled"),this.nodes.cars.forEach(((t,o)=>{void 0!==e[o]?(t.pageCar.el.classList.remove("hidden"),t.trackCarImg.id=e[o].id,t.controlsCarName.el.innerText=e[o].name,t.controlsCarDelete.el.dataset.carId=e[o].id,t.controlsCarGo.el.dataset.carId=e[o].id,t.controlsCarGo.el.removeAttribute("disabled"),t.controlsCarStop.el.dataset.carId=e[o].id,t.controlsCarStop.el.setAttribute("disabled","disabled"),t.updateFormName.el.value=e[o].name,t.updateFormColor.el.value=e[o].color,t.updateFormOk.el.dataset.carId=e[o].id,t.trackCarImg.el.color=e[o].color,t.trackCarImg.el.dataset.carId=e[o].id,t.trackCarImg.el.onload=function(){this.contentDocument.getElementsByClassName("svg")[0].setAttribute("fill",this.color)}):t.pageCar.el.classList.add("hidden")}))}fetchData(e,t){console.log(`page: fetchData(${e}, notRendered)`),fetch(`${s}/garage?_page=${e}&_limit=7`).then((t=>{console.log(t);const o=Number(t.headers.get("X-Total-Count"));return this.pageNum=e,this.carsAmount=o,console.log("page: center fetchData(), pageNum, carsAmount"),t.json()})).then((e=>{console.log("after fetch",e),this.stopAllCars(e,(()=>{console.log("toPageChange"),this.updateData(e),this.renderPage()})),console.log("page: end fetchData()")}))}}({garageRoute(){console.log("entry: garageRoute()");const e=new a;e.fetchData(e.pageNum,!0)}}).garageRoute()})()})();