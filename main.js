(()=>{"use strict";const e='\n  <div class="about">\n    <h2 class="about__heading">How to play?</h2>\n    <div class="section about__reg">\n      <div class="info">\n        <div class="number">1</div>\n        <p class="text">Register new player in game</p>\n      </div>\n      <div class="example"></div>\n    </div>\n    <div class="section about__set">\n      <div class="info">\n        <div class="number">2</div>\n        <p class="text">Configure your game settings</p>\n      </div>\n      <div class="example"></div>\n    </div>\n    <div class="section about__game">\n      <div class="info">\n        <div class="number">3</div>\n        <p class="text">Start your new game1 Remember card positions and match it before times up.</p>\n      </div>\n      <div class="example"></div>\n    </div>\n  </div>\n  ',n='\n  <div class="header">\n    <div class="header-container">\n      <div class="logo">\n        <p class="logo_up">match</p>\n        <p class="logo_down">match</p>\n      </div>\n      <nav class="nav">\n        <a href="#about" class="nav__item nav__about"><div class="nav__icon nav__icon_about"></div><p>About Game</p></a>\n        <a href="#scores" class="nav__item nav__scores"><div class="nav__icon nav__icon_scores"></div><p>Best Players</p></a>\n        <a href="#settings" class="nav__item nav__settings"><div class="nav__icon nav__icon_settings"></div><p>Game Settings</p></a>\n      </nav>\n      <div class="header-buttons">\n        <a href="#game" class="header__btn hidden header__btn_game">Game</a>\n        <button class="header__btn header__btn_form">Register New Player</button>\n        <div class="loggedGamer">\n          <div class="loggedGamer__data"><p>Log in, please</p></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <main id=\'#page\'></main>\n',t='\n  <div class="form-container">\n  <form class="logForm">\n    <a href="#about" class="close-btn"></a>\n    <h2 class="form-heading">Registr new player</h2>\n    <div class="inputs-container">\n      <div class="wrapper">\n        <input type="text" id="fname" placeholder="First name">\n        <div class="ok_fname ok"></div>\n        <div class="err_fname err"><div class="angle"></div><p class="err_message"></p></div>\n      </div>\n      <div class="wrapper">\n        <input type="text" id="lname" placeholder="Last name">\n        <div class="ok_lname ok"></div>\n        <div class="err_lname err"><div class="angle"></div><p class="err_message"></p></div>\n      </div>\n      <div class="wrapper">\n        <input type="email" id="email" placeholder="Email">\n        <div class="ok_email ok"></div>\n        <div class="err_email err"><div class="angle"></div><p class="err_message"></p></div>\n      </div>\n      <div class="wrapper">\n        <button id="cleanButton">Clean</button>\n        <a href="#about" id="addButton" type="submit">Add user</a>\n      </div>\n    </div>\n  </form>\n  </div>\n',o='\n  <div class="gameSettings">\n    <p class="select selectHeading">Game difficulty</p>\n    <select class="select" id="select-difficulty">\n      <option value="16">16 cards</option>\n      <option value="36">36 cards</option>\n      <option value="64">64 cards</option>\n    </select>\n    <p class="select selectTheme">Card theme</p>\n    <select class="select" id="select-theme">\n      <option value="underwater">Underwater</option>\n      <option value="butterflies">Butterflies</option>\n    </select>\n  </div>\n  ',s='\n  <div class="game-wrapper">\n    <div class="game-buttons">\n      <button class="game-btn game-btn_start"></button>\n      <button class="game-btn game-btn_stop hidden"></button>\n      <p class="timer show"><span class="timer-min">00</span>:<span class="timer-sec">00</span></p>\n      <p class="score show">Score</p>\n    </div>\n    <div class="game-cards game-cards_16"></div>\n  </div>\n  ',a='\n  <div class="card-container">\n    <div class="card">\n      <div class="card__front"></div>\n      <div class="card__back"></div>\n    </div>\n  </div>\n  ',r='\n    <div class="congrat-wrapper">\n    <div class="congrat">\n      <p class="congrat-message">Congratulations!</p>\n      <a class="congrat__scores-btn" href="#scores">Go to Best Players</a>\n    </div>\n    </div>\n  ',l='<div class="player"><div class="left-col"><p class="player__name">{fname} {lname}</p><p class="player__email">{email}</p></div><div class="right-col"><p class="player__score">Score: <span class="player__score-num">{score}</span></p></div></div>',c={render:(e,n)=>void 0===n?e:n.map((e=>{let n=l;return Object.keys(e).forEach((t=>{const o=`{${t}}`;n=n.replace(o,e[t])})),n})).join("")},i={isLogged:!1,loggedGamer:{score:0},settings:{theme:"underwater",difficulty:16},indexedDBOk:()=>"indexedDB"in window,settingsObj:{difficulty:16,theme:"underwater"},db:{},addPlayerintoDb(e){console.log("model.addPlayerIntoDb()"),i.addPerson(e)},addPerson(e){const n=i.db.transaction(["players"],"readwrite").objectStore("players").add(e);n.onerror=function(e){console.log("Error",e.target.error.name)},n.onsuccess=function(e){console.log("score success added into DB")}},getBestPlayers(e,n){const t=i.db.transaction(["players"],"readonly").objectStore("players").index("score_idx");let o=0;const s=t.openCursor(IDBKeyRange.lowerBound(0),"prev"),a=[];s.onsuccess=function(e){const n=e.target.result;n&&o<10?(a.push(n.value),o++,n.continue()):document.getElementById("#page").innerHTML=`<div class="scores-container">${c.render(l,a)}</div>`}}},d={getDataFromForm(){console.log("form.getDataFromForm()");const e=document.querySelectorAll(".logForm input"),n={};return console.log(e),e.forEach((e=>{n[e.id]=e.value})),n},validError(e,n){const t=`.ok_${e}`;document.querySelector(t).style.display="none";const o=`.err_${e}`;document.querySelector(o).style.display="block";const s=`${o} .err_message`;document.querySelector(s).innerHTML=n,document.getElementById("addButton").classList.remove("addButton_active")},validSuccess(e){console.log("success input");const n=`.ok_${e}`;document.querySelector(n).style.display="block";const t=`.err_${e}`;document.querySelector(t).style.display="none",d.validateForm()&&document.getElementById("addButton").classList.add("addButton_active")},validateInput(e){console.log("generated by addEventListener in controller.js formRoute()");const n=e.target.getAttribute("type"),t=e.target.value;let o=!1;""===t?(console.log("val",t),o=!0,d.validError(e.target.id,"Error: at least one simbol required!")):!1===/^([a-zA-Z0-9]+)$/.test(t)&&"text"===n?(o=!0,d.validError(e.target.id,"Error: just letters and numbers allowed!")):!1===/[a-zA-Z]+/.test(t)&&"text"===n?(o=!0,d.validError(e.target.id,"Error: field can't consist of numbers only!")):!1===/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(t)&&"email"===n?(o=!0,d.validError(e.target.id,"Error: mail should be correct!")):t.length>30&&(o=!0,d.validError(e.target.id,"Error: maximum 30 symbols allowed!")),console.log("isError ",o),!1===o&&d.validSuccess(e.target.id)},validateForm(){console.log("generated by addEventListener in controller.js formRoute()");const e=document.querySelectorAll(".ok");let n=!0;return e.forEach((e=>{"none"!==e.style.display&&""!==e.style.display||(console.log("into false",e),n=!1)})),!1!==n},cleanForm(){console.log("generated by addEventListener in controller.js formRoute()"),document.querySelectorAll(".logForm .wrapper input").forEach((e=>{e.value="";const n=`.ok_${e.id}`;document.querySelector(n).style.display="none";const t=`.err_${e.id}`;document.querySelector(t).style.display="none"})),document.getElementById("addButton").classList.remove("addButton_active")}},g={aboutRoute(){console.log("about route"),document.getElementById("#page").innerHTML=c.render(e)},aboutrRoute(){console.log("form popup");const n=document.getElementById("#page");n.innerHTML=c.render(e),n.innerHTML+=c.render(t);const o=document.querySelectorAll(".logForm .wrapper input");console.log("inputs",o),o.forEach((e=>{console.log("add event listener",e),e.addEventListener("input",d.validateInput)})),document.querySelector("#addButton").addEventListener("click",(()=>{if(console.log("router.formRoute() addbutton.onclick"),d.validateForm()){console.log("form is valid");const e=d.getDataFromForm();Object.keys(e).forEach((n=>{i.loggedGamer[n]=e[n]})),i.isLogged=!0,console.log("loggedGamer after add user button on form = ",i.loggedGamer),document.querySelector(".loggedGamer__data").innerHTML=`<p class="name">${i.loggedGamer.fname} ${i.loggedGamer.lname}</p><p class="email">${i.loggedGamer.email}</p>`;const n=document.querySelector(".header__btn_game");console.log("show new game button in header",n),n.classList.remove("hidden")}})),document.querySelector("#cleanButton").addEventListener("click",d.cleanForm)},settingsRoute(){console.log("settings route"),document.getElementById("#page").innerHTML=c.render(o);const e=document.querySelector("#select-difficulty"),n=document.querySelector("#select-theme");e.value=i.settings.difficulty,n.value=i.settings.theme,e.addEventListener("change",(e=>{i.settings.difficulty=e.target.value})),n.addEventListener("change",(e=>{i.settings.theme=e.target.value}))},gameRoute(){console.log("game route"),document.getElementById("#page").innerHTML=c.render(s);const e=document.querySelector(".game-cards");e.classList.remove("game-cards_16","game-cards_32","game-cards_64");const n=`game-cards_${i.settings.difficulty}`;e.classList.add(n);for(let n=0;n<i.settings.difficulty;n++)e.innerHTML+=c.render(a);const t=document.querySelector(".game-buttons .game-btn_start"),o=document.querySelector(".game-buttons .game-btn_stop"),l=document.querySelector(".timer-min"),d=document.querySelector(".timer-sec");let u,m,v,p=0,_=0;t.addEventListener("click",(()=>{console.log("start!!!",t,o),t.classList.add("hidden"),o.classList.remove("hidden");let n=0;const s=setInterval((()=>{window.addEventListener("hashchange",(()=>{clearInterval(s)})),n++,console.log(n),d.innerHTML=1===String(n%60).length?`0${String(n%60)}`:String(n%60),l.innerHTML=1===String(Math.floor(n/60)).length?`0${String(Math.floor(n/60))}`:String(Math.floor(n/60))}),1e3);o.addEventListener("click",(()=>{o.classList.add("hidden"),t.classList.remove("hidden"),clearInterval(s),g.gameRoute()})),e.addEventListener("click",(t=>{if(console.log("click!!!!"),t.target.classList.contains("card__back"))if(console.log("Click on card back",t.target,t.target.parentElement),t.target.parentElement.classList.add("flipped"),p++,p%2==1){u=t.target,console.log("Test = ",u.previousElementSibling.style.backgroundImage);const[e]=/[0-9]+/.exec(u.previousElementSibling.style.backgroundImage);console.log("res odd",e),m=e}else{const[o]=/[0-9]+/.exec(t.target.previousElementSibling.style.backgroundImage);if(console.log("res even",o),v=o,v===m){if(_++,u.previousElementSibling.style.backgroundColor="rgb(142, 202, 142)",t.target.previousElementSibling.style.backgroundColor="rgb(142, 202, 142)",_===i.settings.difficulty/2){clearInterval(s);const t=document.querySelector(".game-buttons .score"),o=100*(p/2-(p/2-_))-10*n;console.log("Score = ",o,"clicks = ",p,"same = ",_,"sec = ",n),t.innerHTML=`Score: ${o>0?o:0}`,e.innerHTML+=c.render(r),i.isLogged&&(i.loggedGamer.score=o>0?parseInt(o,10):0,console.log("loggedGamer after congratulations"),i.addPlayerintoDb(i.loggedGamer))}}else console.log("not same"),u.previousElementSibling.style.backgroundColor="rgb(219, 138, 158)",t.target.previousElementSibling.style.backgroundColor="rgb(219, 138, 158)",setTimeout(((e,n)=>{console.log(e),console.log(n),e.parentElement.classList.remove("flipped"),n.parentElement.classList.remove("flipped"),e.previousElementSibling.style.backgroundColor="",n.previousElementSibling.style.backgroundColor=""}),800,u,t.target)}}))}));const y=document.querySelectorAll(".card__front"),b=[];for(let e=0;e<i.settings.difficulty;e++)b.push(e+1);b.sort((function(){return Math.random()-.5})),console.log("sorted num arr",b);const f=[];for(let e=0;e<b.length;e++)b[e]<=i.settings.difficulty/2?f[e]=b[e]:f[e]=b[e]-i.settings.difficulty/2;console.log("sorted num arr",f);let h=0;y.forEach((e=>{e.style.backgroundImage=`url('./assets/${i.settings.theme}/${f[h]}.png')`,console.log(e.style.backgroundImage),h++}))},scoresRoute(){console.log("scores route"),i.getBestPlayers(10,i.settings.difficulty)}};function u(e){const n=window.location.hash.slice(1),t=`${n}Route`;!function(e){document.querySelectorAll(".nav__item").forEach((e=>{e.classList.contains("nav__item_active")&&e.classList.remove("nav__item_active")}));const n=`.nav__${e}`,t=document.querySelector(n);null!=t&&t.classList.add("nav__item_active")}(n),g[t]()}const m={changePageByHash(){document.body.innerHTML=c.render(n),window.addEventListener("hashchange",u),document.querySelector(".header__btn_form").addEventListener("click",(()=>{window.location.hash="#aboutr"})),""===window.location.hash.slice(1)&&(window.location.hash="#about"),u()}};!function(){if(!i.indexedDBOk)return console.log("window.indexedDB - false"),!1;const e=indexedDB.open("oleksawn",1);e.onupgradeneeded=function(e){const n=e.target.result;n.objectStoreNames.contains("players")||n.createObjectStore("players",{autoIncrement:!0}).createIndex("score_idx","score",{unique:!1})},e.onsuccess=function(e){console.log("running DB onsuccess"),i.db=e.target.result,m.changePageByHash()},e.onerror=function(e){console.log("running DB onerror")}}()})();